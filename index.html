<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cumplimiento Normativo - Laboratorio Mexicano</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', system-ui, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #dbeafe 0%, #eff6ff 100%);
            min-height: 100vh;
            color: #1f2937;
            padding: 1rem;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
        }

        header {
            background: white;
            border-radius: 1rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
            text-align: center;
        }

        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 0.5rem;
        }

        .logo-icon {
            width: 3rem;
            height: 3rem;
            background: #1e40af;
            color: white;
            border-radius: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.5rem;
        }

        h1 {
            color: #1e40af;
            font-size: 1.5rem;
        }

        .subtitle {
            color: #6b7280;
            font-size: 1rem;
        }

        .progress-card {
            background: #1e40af;
            color: white;
            border-radius: 1rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            text-align: center;
        }

        .progress-circle {
            width: 100px;
            height: 100px;
            background: rgba(255,255,255,0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1rem;
            font-size: 1.8rem;
            font-weight: bold;
            border: 4px solid rgba(255,255,255,0.3);
        }

        .controls {
            background: white;
            border-radius: 1rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 1rem;
        }

        .search-box {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .search-input {
            width: 100%;
            padding: 1rem;
            border: 1px solid #d1d5db;
            border-radius: 0.75rem;
            font-size: 1rem;
        }

        .filter-box {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .toggle-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: #f8fafc;
            padding: 1rem;
            border-radius: 0.75rem;
            border: 1px solid #e5e7eb;
        }

        .toggle-label {
            font-size: 0.9rem;
            font-weight: 500;
        }

        .toggle {
            position: relative;
            width: 3.5rem;
            height: 1.8rem;
            background: #d1d5db;
            border-radius: 9999px;
            cursor: pointer;
        }

        .toggle.active {
            background: #1e40af;
        }

        .toggle-thumb {
            position: absolute;
            top: 0.2rem;
            left: 0.2rem;
            width: 1.4rem;
            height: 1.4rem;
            background: white;
            border-radius: 50%;
            transition: transform 0.2s;
        }

        .toggle.active .toggle-thumb {
            transform: translateX(1.7rem);
        }

        .section {
            background: white;
            border-radius: 1rem;
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .section-title {
            color: #1e40af;
            margin-bottom: 1.5rem;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #e5e7eb;
        }

        .items-grid {
            display: grid;
            gap: 1rem;
        }

        .item {
            border: 1px solid #e5e7eb;
            border-radius: 0.75rem;
            padding: 1.5rem;
            transition: all 0.3s ease;
        }

        .item.completed {
            background: #f0f9ff;
            opacity: 0.8;
        }

        .item.in-progress {
            background: #fffbeb;
        }

        .item-header {
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .status-indicator {
            width: 1.2rem;
            height: 1.2rem;
            border-radius: 50%;
            border: 2px solid #d1d5db;
            flex-shrink: 0;
            margin-top: 0.2rem;
        }

        .status-indicator.completed {
            background: #10b981;
            border-color: #10b981;
        }

        .status-indicator.in-progress {
            background: #f59e0b;
            border-color: #f59e0b;
        }

        .item-content {
            flex: 1;
        }

        .item-title {
            font-weight: 600;
            margin-bottom: 0.5rem;
            font-size: 1.1rem;
            color: #1f2937;
        }

        .item-ref {
            color: #6b7280;
            font-size: 0.9rem;
            margin-bottom: 1rem;
            font-style: italic;
        }

        .item-description {
            background: #f8fafc;
            padding: 1rem;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
            font-size: 0.9rem;
            line-height: 1.5;
            border-left: 4px solid #1e40af;
        }

        .status-buttons {
            display: flex;
            gap: 0.75rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .status-btn {
            padding: 0.75rem 1.5rem;
            border: 2px solid #d1d5db;
            border-radius: 0.5rem;
            background: white;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.2s;
            min-width: 160px;
        }

        .status-btn.completed {
            background: #10b981;
            color: white;
            border-color: #10b981;
        }

        .status-btn.in-progress {
            background: #f59e0b;
            color: white;
            border-color: #f59e0b;
        }

        .status-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .notes-section {
            margin-top: 1rem;
        }

        .notes-btn {
            background: #dbeafe;
            color: #1e40af;
            border: none;
            border-radius: 0.5rem;
            padding: 0.75rem 1rem;
            cursor: pointer;
            font-size: 0.9rem;
            width: 100%;
            margin-bottom: 0.5rem;
            transition: background 0.2s;
        }

        .notes-btn:hover {
            background: #c7d2fe;
        }

        .notes-textarea {
            width: 100%;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            padding: 1rem;
            font-size: 0.9rem;
            min-height: 100px;
            resize: vertical;
            font-family: inherit;
        }

        .export-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-top: 2rem;
            flex-wrap: wrap;
        }

        .export-btn {
            padding: 1rem 2rem;
            border: none;
            border-radius: 0.75rem;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: all 0.2s;
            min-width: 200px;
        }

        .export-btn.primary {
            background: #1e40af;
            color: white;
        }

        .export-btn.secondary {
            background: white;
            color: #1e40af;
            border: 2px solid #1e40af;
        }

        .export-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }

        .legend {
            display: flex;
            gap: 2rem;
            justify-content: center;
            margin: 1rem 0 2rem 0;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
            color: #6b7280;
        }

        .legend-color {
            width: 1rem;
            height: 1rem;
            border-radius: 50%;
            border: 2px solid;
        }

        .legend-color.completed {
            background: #10b981;
            border-color: #10b981;
        }

        .legend-color.in-progress {
            background: #f59e0b;
            border-color: #f59e0b;
        }

        .legend-color.pending {
            background: white;
            border-color: #d1d5db;
        }

        @media (max-width: 768px) {
            .container {
                padding: 0.5rem;
            }
            
            .controls {
                grid-template-columns: 1fr;
            }
            
            .status-buttons {
                flex-direction: column;
            }
            
            .status-btn {
                width: 100%;
                min-width: auto;
            }
            
            .export-buttons {
                flex-direction: column;
            }
            
            .export-btn {
                width: 100%;
                min-width: auto;
            }
            
            .legend {
                flex-direction: column;
                gap: 0.5rem;
                align-items: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <div class="logo-icon">L</div>
                <h1>Cumplimiento Normativo Laboratorio</h1>
            </div>
            <p class="subtitle">Checklist completo para laboratorios mexicanos - Basado en NOM-007-SSA3-2011</p>
        </header>

        <div class="progress-card">
            <div class="progress-circle" id="progressValue">0%</div>
            <div id="progressText">0 de 0 √≠tems completados</div>
        </div>

        <div class="legend">
            <div class="legend-item">
                <div class="legend-color completed"></div>
                <span>Cumplimiento total</span>
            </div>
            <div class="legend-item">
                <div class="legend-color in-progress"></div>
                <span>En proceso</span>
            </div>
            <div class="legend-item">
                <div class="legend-color pending"></div>
                <span>Pendiente</span>
            </div>
        </div>

        <div class="controls">
            <div class="search-box">
                <label for="searchInput" style="font-weight: 500; margin-bottom: 0.5rem;">üîç Buscar en todos los √≠tems:</label>
                <input type="text" class="search-input" id="searchInput" placeholder="Escribe para buscar por t√≠tulo, referencia o descripci√≥n...">
            </div>
            <div class="filter-box">
                <label style="font-weight: 500; margin-bottom: 0.5rem;">Filtros:</label>
                <div class="toggle-container">
                    <div class="toggle-label">Mostrar solo pendientes</div>
                    <div class="toggle" id="pendingToggle">
                        <div class="toggle-thumb"></div>
                    </div>
                </div>
            </div>
        </div>

        <div id="sectionsContainer">
            <!-- Las secciones se cargar√°n aqu√≠ con JavaScript -->
        </div>

        <div class="export-buttons">
            <button class="export-btn primary" onclick="exportarDatos()">üì• Exportar Datos (JSON)</button>
            <button class="export-btn secondary" onclick="limpiarDatos()">üîÑ Restablecer Todo</button>
            <button class="export-btn secondary" onclick="window.print()">üñ®Ô∏è Exportar PDF</button>
        </div>
    </div>

    <script>
        // DATOS COMPLETOS DEL LABORATORIO
        const sections = [
            {
                id: "documentos",
                title: "üìÑ Documentos y Manuales",
                items: [
                    {
                        id: "manual-organizacion",
                        label: "Manual de Organizaci√≥n",
                        ref: "Ref. 5.5.1",
                        description: "Define la estructura y filosof√≠a del laboratorio. Incluye: organigrama, descripci√≥n de puestos, perfiles y requisitos, firmas de responsabilidad."
                    },
                    {
                        id: "manual-proc-admin",
                        label: "Manual de Procedimientos Administrativos", 
                        ref: "Ref. 5.5.2",
                        description: "Procedimientos no anal√≠ticos: recepci√≥n de pacientes, toma de muestras, entrega de resultados, compras, inventarios."
                    },
                    {
                        id: "pnos-metodos",
                        label: "PNO por cada m√©todo anal√≠tico",
                        ref: "Ref. 5.5.3", 
                        description: "Procedimientos normalizados de operaci√≥n para cada prueba. Incluye: fundamento, procedimiento paso a paso, valores de referencia, bibliograf√≠a."
                    },
                    {
                        id: "manual-muestras",
                        label: "Manual de toma y transporte de muestras",
                        ref: "Ref. 5.5.5",
                        description: "Gu√≠a completa para toma, identificaci√≥n, conservaci√≥n y transporte de muestras. Criterios de aceptaci√≥n/rechazo."
                    },
                    {
                        id: "manual-equipo", 
                        label: "Manual de manejo de equipo",
                        ref: "Ref. 5.5.6",
                        description: "Manual por cada equipo: uso, cuidados, mantenimiento preventivo, referencias al manual del fabricante."
                    },
                    {
                        id: "manual-bioseguridad",
                        label: "Manual de seguridad e higiene",
                        ref: "Ref. 5.5.7",
                        description: "Pol√≠ticas de bioseguridad: identificaci√≥n de riesgos, EPP, manejo de derrames, plan de RPBI."
                    }
                ]
            },
            {
                id: "programas",
                title: "üìä Programas",
                items: [
                    {
                        id: "prog-mantenimiento",
                        label: "Programa de mantenimiento preventivo",
                        ref: "Ref. 5.5.9",
                        description: "Programa anualizado con calendario por equipo, periodicidad, responsable y registros de mantenimiento."
                    },
                    {
                        id: "prog-ci",
                        label: "Control interno de calidad",
                        ref: "Ref. 7.1",
                        description: "Control diario con gr√°ficas Levey-Jennings, reglas de Westgard, acciones correctivas documentadas."
                    },
                    {
                        id: "prog-peec",
                        label: "Evaluaci√≥n externa de calidad",
                        ref: "Ref. 7.2", 
                        description: "Participaci√≥n en PEEC/PACAL. Conservar: contrato, informes, investigaci√≥n de no conformidades."
                    },
                    {
                        id: "prog-desinfeccion",
                        label: "Programa de desinfecci√≥n",
                        ref: "Ref. 5.5.10",
                        description: "Programa de desinfecci√≥n y control de plagas. Productos autorizados, frecuencias, bit√°coras."
                    },
                    {
                        id: "prog-capacitacion",
                        label: "Programa anual de capacitaci√≥n",
                        ref: "Capacitaci√≥n",
                        description: "Plan tem√°tico anual: bioseguridad, PNOs, equipos, calidad. Listas de asistencia y constancias."
                    }
                ]
            },
            {
                id: "bitacoras",
                title: "üìã Bit√°coras y Registros",
                items: [
                    {
                        id: "bitacora-mant-cal",
                        label: "Bit√°cora de mantenimiento y calibraci√≥n",
                        ref: "Ref. 5.5.4",
                        description: "Registro por equipo con fecha, actividad, proveedor, resultados y pr√≥xima fecha programada."
                    },
                    {
                        id: "bitacora-temperatura",
                        label: "Bit√°cora de control de temperatura",
                        ref: "Temperatura",
                        description: "Registro diario de refrigeradores, congeladores, incubadoras. Valores, rangos y acciones por desviaciones."
                    },
                    {
                        id: "registros-ci",
                        label: "Registros de control interno",
                        ref: "Control Calidad",
                        description: "Evidencia completa: valores de control, gr√°ficos, interpretaci√≥n, acciones correctivas."
                    }
                ]
            },
            {
                id: "areas",
                title: "üè¢ √Åreas e Infraestructura",
                items: [
                    {
                        id: "recepcion-sala",
                        label: "Recepci√≥n y sala de espera separadas",
                        ref: "Ref. 5.2.1",
                        description: "√Åreas separadas de √°reas t√©cnicas. Control de flujo de pacientes y muestras."
                    },
                    {
                        id: "toma-muestras",
                        label: "√Årea de toma con privacidad",
                        ref: "Ref. 5.2.2-5.2.3",
                        description: "√Årea con privacidad, silla con descansabrazos, contenedor para punzocortantes, insumos accesibles."
                    },
                    {
                        id: "areas-proceso",
                        label: "Barrera entre actividades incompatibles", 
                        ref: "Ref. 5.2.4",
                        description: "Separaci√≥n f√≠sica entre actividades incompatibles (microbiolog√≠a vs qu√≠mica). Flujo unidireccional."
                    },
                    {
                        id: "almacen-reactivos",
                        label: "Almac√©n de reactivos controlado",
                        ref: "Ref. 5.2.6",
                        description: "Almac√©n seco, ventilado, temperatura controlada. PEPS/FEFO, control de caducidades, hojas de seguridad."
                    },
                    {
                        id: "almacen-rpbi",
                        label: "Almac√©n temporal de RPBI",
                        ref: "Ref. 5.2.7",
                        description: "√Årea techada, ventilada, se√±alizada. Acceso restringido, segregaci√≥n por tipo de residuo."
                    }
                ]
            },
            {
                id: "bioseguridad",
                title: "üõ°Ô∏è Bioseguridad",
                items: [
                    {
                        id: "epp-registros",
                        label: "Dotaci√≥n y registro de EPP",
                        ref: "EPP",
                        description: "Dotaci√≥n completa y registro por empleado (tallas, fechas, reposici√≥n)."
                    },
                    {
                        id: "senializacion",
                        label: "Se√±alizaci√≥n de riesgos y EPP",
                        ref: "Se√±alizaci√≥n", 
                        description: "Se√±alizaci√≥n clara de riesgos y EPP obligatorio por cada √°rea del laboratorio."
                    },
                    {
                        id: "procedimientos-epp",
                        label: "Procedimientos de EPP por actividad",
                        ref: "Procedimientos",
                        description: "Procedimientos escritos que especifican EPP requerido por cada actividad (toma, micro, qu√≠micos)."
                    }
                ]
            },
            {
                id: "rpbi",
                title: "üóëÔ∏è Manejo de RPBI",
                items: [
                    {
                        id: "clasificacion",
                        label: "Clasificaci√≥n y segregaci√≥n correcta",
                        ref: "Clasificaci√≥n",
                        description: "Clasificaci√≥n y segregaci√≥n en el punto de generaci√≥n: biol√≥gico-infeccioso, punzocortante, etc."
                    },
                    {
                        id: "contrato-recolector",
                        label: "Contrato con recolector autorizado",
                        ref: "Contrato RPBI",
                        description: "Contrato vigente con recolector autorizado y manifiestos de recolecci√≥n firmados."
                    },
                    {
                        id: "contenedores",
                        label: "Contenedores adecuados",
                        ref: "Contenedores",
                        description: "Uso de contenedores r√≠gidos para punzocortantes y bolsas de color/calibre normado."
                    }
                ]
            },
            {
                id: "rh",
                title: "üë• Recursos Humanos",
                items: [
                    {
                        id: "expedientes-rh",
                        label: "Expediente completo por empleado",
                        ref: "Expedientes",
                        description: "Expediente con: CV, identificaci√≥n, t√≠tulos/c√©dulas, constancias, diplomas."
                    },
                    {
                        id: "descripcion-puesto",
                        label: "Descripci√≥n de puesto firmada",
                        ref: "Descripci√≥n",
                        description: "Descripci√≥n firmada con funciones, responsabilidades y autoridad espec√≠fica."
                    },
                    {
                        id: "eval-competencias",
                        label: "Evaluaci√≥n de competencias",
                        ref: "Competencias",
                        description: "Programa y registros de evaluaci√≥n de competencias por puesto/proceso."
                    }
                ]
            },
            {
                id: "trazabilidad",
                title: "üìù Trazabilidad",
                items: [
                    {
                        id: "solicitud",
                        label: "Solicitud completa y √∫nica",
                        ref: "Solicitud",
                        description: "Solicitud completa, √∫nica por paciente/muestra con todos los requisitos obligatorios."
                    },
                    {
                        id: "etiquetado",
                        label: "Etiquetado con 2 identificadores",
                        ref: "Etiquetado",
                        description: "Etiquetado frente al paciente con m√≠nimo 2 identificadores (nombre + fecha nacimiento)."
                    },
                    {
                        id: "informe",
                        label: "Informe con contenidos obligatorios",
                        ref: "Informe", 
                        description: "Informe con unidades metrol√≥gicas, firma y datos del responsable, valores de referencia."
                    }
                ]
            }
        ];

        // ESTADO DE LA APLICACI√ìN
        let estado = {};
        let notas = {};
        let showOnlyPending = false;
        let searchQuery = "";

        // CARGAR DATOS GUARDADOS
        function cargarDatos() {
            const guardado = localStorage.getItem('labChecklistCompleto');
            if (guardado) {
                try {
                    const datos = JSON.parse(guardado);
                    estado = datos.estado || {};
                    notas = datos.notas || {};
                } catch (e) {
                    console.log("No hay datos guardados previos");
                }
            }
        }

        // GUARDAR DATOS
        function guardarDatos() {
            const datos = {
                estado,
                notas,
                actualizado: new Date().toISOString(),
                version: "2.0"
            };
            localStorage.setItem('labChecklistCompleto', JSON.stringify(datos));
        }

        // RENDERIZAR SECCIONES
        function renderizarSecciones() {
            const container = document.getElementById('sectionsContainer');
            const searchTerm = searchQuery.toLowerCase();
            
            container.innerHTML = '';
            
            sections.forEach(seccion => {
                const itemsFiltrados = seccion.items.filter(item => {
                    // Filtro por b√∫squeda
                    if (searchTerm) {
                        const matchesSearch = 
                            item.label.toLowerCase().includes(searchTerm) ||
                            item.ref.toLowerCase().includes(searchTerm) ||
                            item.description.toLowerCase().includes(searchTerm) ||
                            seccion.title.toLowerCase().includes(searchTerm);
                        
                        if (!matchesSearch) return false;
                    }
                    
                    // Filtro por estado (solo pendientes)
                    if (showOnlyPending && estado[item.id] === 'completed') {
                        return false;
                    }
                    
                    return true;
                });
                
                if (itemsFiltrados.length === 0) return;
                
                const sectionEl = document.createElement('div');
                sectionEl.className = 'section';
                sectionEl.innerHTML = `<h2 class="section-title">${seccion.title}</h2>`;
                
                const itemsGrid = document.createElement('div');
                itemsGrid.className = 'items-grid';
                
                itemsFiltrados.forEach(item => {
                    const itemEstado = estado[item.id] || '';
                    const itemNotas = notas[item.id] || '';
                    
                    const itemEl = document.createElement('div');
                    itemEl.className = `item ${itemEstado === 'completed' ? 'completed' : ''} ${itemEstado === 'in-progress' ? 'in-progress' : ''}`;
                    itemEl.innerHTML = `
                        <div class="item-header">
                            <div class="status-indicator ${itemEstado}"></div>
                            <div class="item-content">
                                <div class="item-title">${item.label}</div>
                                <div class="item-ref">${item.ref}</div>
                                <div class="item-description">${item.description}</div>
                                <div class="status-buttons">
                                    <button class="status-btn ${itemEstado === 'completed' ? 'completed' : ''}" 
                                            onclick="cambiarEstado('${item.id}', 'completed')">
                                        ‚úÖ Cumplimiento Total
                                    </button>
                                    <button class="status-btn ${itemEstado === 'in-progress' ? 'in-progress' : ''}" 
                                            onclick="cambiarEstado('${item.id}', 'in-progress')">
                                        üü° En Proceso
                                    </button>
                                </div>
                                <div class="notes-section">
                                    <button class="notes-btn" onclick="toggleNotas('${item.id}', this)">
                                        ${itemNotas ? 'üìù Editar nota' : '‚úèÔ∏è A√±adir nota'}
                                    </button>
                                    <textarea class="notes-textarea" id="notes-${item.id}" 
                                              placeholder="Observaciones, evidencia, plan de acci√≥n, fechas importantes..."
                                              oninput="guardarNota('${item.id}', this.value)"
                                              style="display: ${itemNotas ? 'block' : 'none'}">${itemNotas}</textarea>
                                </div>
                            </div>
                        </div>
                    `;
                    
                    itemsGrid.appendChild(itemEl);
                });
                
                sectionEl.appendChild(itemsGrid);
                container.appendChild(sectionEl);
            });
            
            actualizarProgreso();
        }

        // CAMBIAR ESTADO DE UN √çTEM
        function cambiarEstado(itemId, nuevoEstado) {
            estado[itemId] = nuevoEstado;
            guardarDatos();
            renderizarSecciones();
        }

        // ALTERNAR VISIBILIDAD DE NOTAS
        function toggleNotas(itemId, boton) {
            const textarea = document.getElementById(`notes-${itemId}`);
            const estaVisible = textarea.style.display === 'block';
            
            textarea.style.display = estaVisible ? 'none' : 'block';
            boton.textContent = estaVisible ? '‚úèÔ∏è A√±adir nota' : 'üìù Editar nota';
        }

        // GUARDAR NOTA
        function guardarNota(itemId, texto) {
            notas[itemId] = texto;
            guardarDatos();
        }

        // ACTUALIZAR PROGRESO
        function actualizarProgreso() {
            const todosItems = sections.flatMap(s => s.items);
            const total = todosItems.length;
            const completados = Object.values(estado).filter(e => e === 'completed').length;
            const porcentaje = total ? Math.round((completados / total) * 100) : 0;
            
            document.getElementById('progressValue').textContent = `${porcentaje}%`;
            document.getElementById('progressText').textContent = `${completados} de ${total} √≠tems completados`;
        }

        // EXPORTAR DATOS
        function exportarDatos() {
            const datos = {
                sections,
                estado,
                notas,
                exportado: new Date().toISOString(),
                totalItems: sections.flatMap(s => s.items).length,
                completados: Object.values(estado).filter(e => e === 'completed').length,
                enProceso: Object.values(estado).filter(e => e === 'in-progress').length
            };
            
            const blob = new Blob([JSON.stringify(datos, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `cumplimiento-lab-completo-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // LIMPIAR TODOS LOS DATOS
        function limpiarDatos() {
            if (confirm('¬øEst√°s seguro de que quieres restablecer todos los datos? Se perder√° todo el progreso guardado.')) {
                estado = {};
                notas = {};
                localStorage.removeItem('labChecklistCompleto');
                renderizarSecciones();
                alert('Todos los datos han sido restablecidos correctamente.');
            }
        }

        // INICIALIZAR APLICACI√ìN
        document.addEventListener('DOMContentLoaded', function() {
            cargarDatos();
            renderizarSecciones();
            
            // Configurar b√∫squeda
            document.getElementById('searchInput').addEventListener('input', function(e) {
                searchQuery = e.target.value;
                renderizarSecciones();
            });
            
            // Configurar filtro de pendientes
            document.getElementById('pendingToggle').addEventListener('click', function() {
                showOnlyPending = !showOnlyPending;
                this.classList.toggle('active', showOnlyPending);
                renderizarSecciones();
            });
        });
    </script>
</body>
</html>
